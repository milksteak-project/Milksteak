#!/bin/bash
# Usage: steak update [package name]
# Summary: Update one or all steak packages
set -e

name=$1

RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

function update {

  name=$1

  rm -rf $HOME/usr/etc/packages/$name
  mkdir -p $HOME/usr/etc/packages/$name

  pkgdir=$HOME/usr/etc/packages/$name
  pkg=$HOME/usr/etc/packages/$name/$name.sh

  printf '\e[1;31m%*s\n\e[m' "${COLUMNS:-$(tput cols)}" '' | tr ' ' =
  echo -e "${RED}>>>>>>>> ${NC}Updating package: ${GREEN}$name${NC}"
  wget -O $pkg https://raw.githubusercontent.com/milksteak-project/steaks/master/packages/$name/$name.sh -q --show-progress

  source $pkgdir/$name.sh
}

if [ $name ]
then
  update $name
else
  for pkg in $HOME/usr/etc/packages/*
  do
    name=`basename $pkg`
    update $name
  done
fi
