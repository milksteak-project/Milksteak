#!/usr/bin/env bash
# Usage: steak update [package name]
# Summary: Update one or all steak packages
set -e

name=$1

function update() {

  name=$1

  rm -rf $HOME/usr/etc/packages/$name
  mkdir -p $HOME/usr/etc/packages/$name

  pkgdir=$HOME/usr/etc/packages/$name
  pkg=$HOME/usr/etc/packages/$name/$name.sh

  printf '\e[1m%*s\n\e[m' "${COLUMNS:-$(tput cols)}" '' | tr ' ' =
  echo -e ">>>>> Updating package: $name"
  wget -O $pkg https://raw.githubusercontent.com/milksteak-project/steaks/master/packages/$name/$name.sh -q --show-progress
  source $pkgdir/$name.sh
  echo
}

if [ $name ]
then
  update $name
else
  for pkg in $HOME/usr/etc/packages/*
  do
    name=`basename $pkg`
    update $name
  done
fi
